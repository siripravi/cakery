---
import Layout from "../layouts/Layout.astro";
import ShowAllProducts from "../components/Products/ShowAllProducts.vue";

//import { getAllProducts } from "../graphql/queries/getAllProducts";

//const allProducts = await getAllProducts();
import gql from "graphql-tag";
import client from "../lib/apollo-client";
/*
const {
  categoryId: { type: String, required: false },
  categorySlug: { type: String, required: false },
} = Astro.props;*/
const {categoryId,categorySlug} = Astro.props;
const productVariables = { "limit": 99 };
const { data: allProducts }  = await client.query({
  query: gql`
  {
  products(first: 24) {
    nodes {
      databaseId
      name
      onSale
      slug
      image {
        sourceUrl
      }
      ... on SimpleProduct {
        databaseId
        price
        regularPrice
        salePrice
      }
      ... on VariableProduct {
        databaseId
        price
        regularPrice
        salePrice
        variations {
          nodes {
            price
            regularPrice
            salePrice
          }
        }
      }
    }
  }
}
` });

const categoryVariables = { "id": 6 };
const { data: allCategoryProducts }= await client.query({
  query: gql`
  query ProductsFromCategory($id: ID!) {
  productCategory(id: $id, idType: ID) {
    id
    name
    products(first: 50) {
      nodes {
        id
        databaseId
        onSale
        averageRating
        slug
        description
        image {
          id
          uri
          title
          srcSet
          sourceUrl
        }
        name
        ... on SimpleProduct {
          salePrice
          regularPrice
          onSale
          price
          id
        }
        ... on VariableProduct {
          salePrice
          regularPrice
          onSale
          price
          id
        }
        ... on ExternalProduct {
          price
          id
          externalUrl
        }
        ... on GroupProduct {
          products {
            nodes {
              ... on SimpleProduct {
                id
                price
              }
            }
          }
          id
        }
      }
    }
  }
}`, categoryVariables});

---

<Layout title="Products">
  <main>
    <h1 class="text-3xl text-center font-bold p-6">Products page</h1>
     <ShowAllProducts allProducts={allProducts} allCategoryProducts={allCategoryProducts} />  
  </main>
</Layout>
